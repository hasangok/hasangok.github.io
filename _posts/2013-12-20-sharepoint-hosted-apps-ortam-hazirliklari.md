---
layout: post
title: SharePoint-Hosted Apps - Ortam Hazırlıkları
date: 2013-12-20 00:19
author: hasangok
comments: true
Tags: [SharePoint, Sharepoint 2013, SharePoint Management Shell, SharePoint-Hosted App]
---
<p style="text-align: justify;"><img class="alignleft  wp-image-489" style="margin: 0px 1px; border: 0px;" alt="Sharepoint-2013-Logo" src="https://raw.githubusercontent.com/hasangok/hasangok.github.io/master/uploads/2013/12/Sharepoint-2013-Logo-150x150.png" width="120" height="120" />Uzun zamandır bu yazıyı yazmak istiyorum belki birinin işine yarar düşüncesiyle. Bundan birkaç ay öncesinde benden örnek bir uygulama (yazının devamında uygulama diye bahsettiğim, <em>SharePoint-Hosted App</em>'in kendisi olacak) geliştirmem istendiğinde, çetrefilli bir işin ortasında buldum kendimi. Şu an baktığımda, en azından geliştirme ortamını hazırlama işleminin o kadar da zor olmadığını düşünsem de, yeni başlayacak arkadaşların kafalarında oluşan soru işaretlerini bir nebze de olsa giderip, ilk uygulamalarını geliştirmelerinde yardımcı olabileceğimi umuyorum. Piyasada konuyla alakalı yüzlerce makale olsa da, ben elde ettiğim sonuçların özeti ve hazırlıkları tamamlamanın en kısa yolu niteliğinde bu yazıyı sizlerle paylaşmak istedim. Neyse, uzun cümleler kurmaktansa adım adım işlemlerimize geçelim.</p>
<p style="text-align: justify;"><strong>Adım 1:</strong> Bilmemiz gereken ilk şey, <em>SharePoint 2013</em> üzerinde uygulama geliştirebilmek için, iki servisin çalışıyor olması gerekiyor. Bunlar:</p>

<ol style="text-align: justify;">
	<li>App Management Service</li>
	<li>Microsoft Sharepoint Foundation Subscription Settings Service</li>
</ol>
<!--more-->
<p style="text-align: justify;"><img class="aligncenter size-full wp-image-537" alt="sp2013-services-on-server" src="https://raw.githubusercontent.com/hasangok/hasangok.github.io/master/uploads/2013/12/sp2013-services-on-server.png" width="949" height="672" /></p>
<p style="text-align: justify;">Bu iki servisin çalıştığını teyit etmek ve çalışmıyorsa başlatmak için <em>Central Administration</em> sayfasından <em>Manage services on server</em> linkine tıklayıp, ilgili servisleri başlatabilir / çalıştığını teyit edebiliriz.</p>
<p style="text-align: justify;"><strong>Adım 2:</strong> <em>Sistem hesabı</em> kullanıcısıyla uygulama geliştirmesi yapamıyoruz. Bu yüzden uygulama geliştirebilmek için kendimize bir kullanıcı oluşturmamız gerekiyor. İstediğiniz ismi seçmekte özgür olmakla beraber ben bu kullanıcıyı <strong><em>SpAppAdm</em></strong> adıyla oluşturacağım. <em>Active Directory Users and Computers</em> kullanarak aşağıdaki ekran görüntülerinde gördüğünüz gibi yeni bir kullanıcı oluşturabilirsiniz.</p>
<p style="text-align: justify;"><img class="aligncenter size-full wp-image-538" alt="ad-new-user-1" src="https://raw.githubusercontent.com/hasangok/hasangok.github.io/master/uploads/2013/12/ad-new-user-1.png" width="763" height="536" /></p>
<p style="text-align: justify;"><img class="aligncenter size-full wp-image-539" alt="ad-new-user-2" src="https://raw.githubusercontent.com/hasangok/hasangok.github.io/master/uploads/2013/12/ad-new-user-2.png" width="767" height="537" /></p>
<p style="text-align: justify;">Burada önemli gördüğüm birkaç noktaya değinmek istiyorum:</p>

<ol style="text-align: justify;">
	<li><em>Active Directory</em>'de oluşturduğunuz bu kullanıcıyı bir sonraki adımda (ve daha sonralarda) kullanabilmek için <em>User Profile Synchronization</em> başlatmamız gerekiyor. <em>SharePoint 2013</em>'ün <em>Foundation</em> sürümü için böyle bir özellik olmadığından senkronizasyon işlemine de gerek kalmıyor.</li>
	<li>Kullanıcımız geliştirdiği uygulamaları deploy edeceğinden, <em>SharePoint</em> veritabanında gerekli yetkileri tanımlamamız gerekiyor. Bunun için <em>SQL Server Management Studio</em> ile veritabanı sunucusuna bağlanıp <em>Security</em> &gt; <em>Logins</em> &gt; <em>New Login</em> yolunu izleyerek <em>Server Roles</em> sekmesinden en azından <em>dbcreator</em>, <em>public</em> ve <em>securityadmin</em> seçeneklerini işaretlememiz gerekiyor.</li>
	<li>Uygulamaları çalıştırırken herhangi bir sıkıntı yaşanmaması adına, kullanıcımızın <em>Local Admin</em> (yerel yönetici) hesabı olarak tanımlanması gerekiyor. Bu işlemi <em>Control Panel</em> (Denetim Masası) &gt; <em>Manage User Accounts</em> (Kullanıcı Hesaplarını Yönet) penceresinden yapabiliriz.</li>
	<li>Oluşturduğumuz kullanıcı, sunucuya uzak masaüstü bağlantısı yapacaksa (bu adım şart değil) ilgili yetkilerin verilmesi gerekiyor. Bunun için <em>Computer</em> (Bilgisayar) &gt; <em>Properties</em> (Özellikler) &gt; <em>Advanced System Settings</em> (Gelişmiş Sistem Ayarları) penceresinin <em>Remote</em> (Uzak) sekmesine geçerek uzak bağlantılara izin veriyor, <em>Select Users</em> (Kullanıcıları Seç) butonuna tıklayarak kullanıcımızı uzak bağlantı yapabilecek hale getiriyoruz.</li>
</ol>
<p style="text-align: justify;"><strong>Adım 3:</strong> Şimdi uygulamalarımızı geliştireceğimiz bir <em>Developer Site</em>si oluşturalım. Yine <em>Central Administration</em> sayfasından <em>Create Site Collections</em> linkine tıklayıp, buradan <em>Developer Site</em> oluşturabilir ve <em>Primary Site Collection Administrator</em> olarak biraz önce oluşturduğumuz kullanıcıyı seçebiliriz.</p>
<p style="text-align: justify;"><strong>Adım 4:</strong> Şimdi uygulama geliştirmek için gereken <em>Service Application</em>'ları (servis uygulamaları) ve veritabanlarını oluşturmak için <em>SharePoint 2013 Management Shell</em>'i çalıştırıyor ve adım adım aşağıdaki kodları çalıştırıyoruz:</p>

<pre class="lang:default decode:true">$account = Get-SPManagedAccount "Administrator" 
$appPoolSubSvc = New-SPServiceApplicationPool -Name "Settings Service App Pool" -Account $account
$appSubSvc = New-SPSubscriptionSettingsServiceApplication –ApplicationPool $appPoolSubSvc –Name "Settings Service App" –DatabaseName "SettingsServiceDB"
$proxySubSvc = New-SPSubscriptionSettingsServiceApplicationProxy –ServiceApplication $appSubSvc
$appPoolAppSvc = New-SPServiceApplicationPool -Name AppServiceAppPool -Account $account
$appAppSvc = New-SPAppManagementServiceApplication -ApplicationPool $appPoolAppSvc -Name "Application Service App" -DatabaseName "AppServiceDB"
$proxyAppSvc = New-SPAppManagementServiceApplicationProxy -ServiceApplication $appAppSvc</pre>
<p style="text-align: justify;"><strong>Not:</strong> Bu örnekteki <em>Administrator</em> kullanıcısı benim tarafımdaki <em>Managed Account</em> oluyor. Siz hangisini seçeceğinizi bilmiyorsanız aynı pencerede <em><strong>Get-SPManagedAccount</strong></em> yazıp çalıştırarak <em>Managed Account</em>'ların listesini görebilirsiniz. Yukarıdaki kodların ne iş yaptığıyla ilgili uzun uzun açıklama yapabilecek durumda olmadığımdan sadece özünü sizlerle paylaştım. Detaylı bilgiye ihtiyacınız olursa <a href="http://technet.microsoft.com/en-us/library/fp161236.aspx" target="_blank">buradan</a> konuyla ilgili açıklamalara ulaşabilirsiniz.</p>
<p style="text-align: justify;"><strong>Adım 5:</strong> Uygulamalarımızı oluşturduğumuzda <em>SharePoint</em> bunlara belli bir yapıda URL'ler veriyor (<em>app-abcd1234.domain.com</em> gibi). Bu yüzden uygulamalarımız için kullanacağımız alan adını ve uygulama ön ekinin ne olacağını belirtmemiz gerekiyor. Bu işlem için <em>Central Administration</em> sayfasından <em>Apps</em> &gt;  <em>Configure App URLs</em> linkine tıklayıp, uygulamalarımız için bir alan adı ve ön ek seçiyoruz:</p>
<p style="text-align: justify;"><img class="aligncenter size-full wp-image-540" alt="sp2013-configure-app-urls" src="https://raw.githubusercontent.com/hasangok/hasangok.github.io/master/uploads/2013/12/sp2013-configure-app-urls.png" width="949" height="672" /></p>
<p style="text-align: justify;"><strong>Not:</strong> Burada da değinmek istediğim bir nokta var. Bir sonraki adımda ilgili <em>DNS</em> ayarlarını yapacak ve keyfimize göre seçtiğimiz bu alan adını hosts dosyası ile de yönlendirecek olsak da, halihazırda kullanılmakta olan bir alan adı seçersek uygulamamızı çalıştırdığımızda dış siteye gitme problemiyle karşılaştım. Bu yüzden uygulamalarımız için seçtiğimiz alan adı, kullanılmayan bir alan adı olsun: <em>hasanapps.com</em> gibi.</p>
<p style="text-align: justify;"><strong>Adım 6:</strong> Şimdi sıra geldi uygulamalarımız için kullanacağımız alan adı için <em>DNS</em> kayıtlarını oluşturmaya. Başlat menüsüne <em>DNS</em> yazıp <em>DNS Manager</em>'ı açıyor ve <em>Forward Lookup Zones</em>'u genişletip <em>SharePoint</em>'in kurulu olduğu domaine sağ tıklayarak (benim örneğimde hasan.local) yeni A kaydı oluşturuyoruz.</p>
<p style="text-align: justify;"><img class="aligncenter size-full wp-image-541" alt="dns-manager-new-host" src="https://raw.githubusercontent.com/hasangok/hasangok.github.io/master/uploads/2013/12/dns-manager-new-host.png" width="766" height="535" /></p>
<p style="text-align: justify;"><em>IP Adresi</em> olarak <strong><em>127.0.0.1</em></strong> yazıp <em>Add Host</em> butonuna tıklayıp pencereyi kapatıyoruz. <em>Forward Lookup Zones</em>'a bu kez sağ tıklayarak <em>New Zone</em> diyor ve <em>Zone Name</em> olarak bir önceki adımda uygulamalarımız için seçtiğimiz alan adını yazıyoruz (bu yazı için <em>hasanapps.com</em> örneğinde olduğu gibi). Varsayılan seçeneklerle sihirbazı tamamlayıp alan adımıza ait kaydı oluşturduğumuzda, bu kayda sağ tıklayıp <em>New Alias (CNAME)</em> seçiyor ve aşağıdaki bilgileri giriyoruz:</p>
<p style="text-align: justify; padding-left: 30px;"><strong>Alias name:</strong> *
<strong>Fully qualified domain name:</strong> <em>Browse</em> butonuna tıklayıp, bu adımın başında <em>127.0.0.1</em> IP adresi ile oluşturduğumuz A kaydını seçiyoruz.</p>
<p style="text-align: justify;"><em>OK</em> butonuna tıklayıp buradaki işimizi de bitirmiş oluyoruz. Son olarak <em>C:\Windows\System32\drivers\etc\</em> yolunda bulunan <strong><em>hosts</em></strong> dosyasını açıp, <em>127.0.0.1</em> IP adresini <em>SharePoint</em> adresimize yönlendiriyoruz (benim örneğim için ekran görüntülerindeki adres çubuğunda gördüğünüz üzere: <em>spf</em>)</p>

<pre class="lang:default decode:true">127.0.0.1	spf</pre>
<p style="text-align: justify;"><strong>Not:</strong> Çeşitli kaynaklar konuyla alakalı açıklamalarında, bu <em>DNS</em> kayıtlarını oluşturduktan sonra rastgele oluşturduğunuz bir uygulama URL'sine ping attığınızda (<em>ping app-abc123.hasanapss.com</em>) cevap almanız gerektiğini yazmışlar. Birkaç bilgisayarda bu ortamı hazırladığımda yaptığım denemeler sonucu her zaman cevap alamadım. Ancak ping atamıyor olmak, uygulamaların çalışmasına engel olmadı. Uygulamanızı deploy ettikten sonra herhangi bir sorunla karşılaşmıyorsunuz, ping alacağım diye kendinizi paralamanıza gerek olmadığını belirtmek istiyorum :)</p>
<p style="text-align: justify;"><strong>Adım 7:</strong> Bu aşamada uygulama geliştirmek için her şey hazır. Tek sorunumuz şu olacak: bir uygulama oluşturup deploy ettiğinizde, uygulamanız sizden sürekli oturum açmanızı isteyecek ama bir türlü oturum açılamayacak. Bu sorunu gidermek için de başlat menüsüne <em><strong>regedit</strong></em> yazıyor ve kayıt defterinde şu yolu izliyoruz: <em>HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Lsa</em>. Buraya <em>32 bit DWORD</em> ekleyip adını <em><strong>DisableLoopbackCheck</strong></em>, değerini <strong><em>1</em></strong> olarak giriyoruz.</p>
<p style="text-align: justify;">Ortamımız hazır. Artık uygulama geliştirmek için oluşturduğumuz kullanıcı ile sunucuda oturum açtıktan sonra <em>Visual Studio</em>'yu çalıştırıp (yönetici olarak) yeni bir <em>SharePoint-Hosted App</em> projesi oluşturabilir ve uygulamamızı deploy edebiliriz.</p>
<p style="text-align: justify;"><img class="aligncenter size-full wp-image-542" alt="sp2013-hello-user-app" src="https://raw.githubusercontent.com/hasangok/hasangok.github.io/master/uploads/2013/12/sp2013-hello-user-app.png" width="800" height="548" /></p>
<p style="text-align: justify;">Ortamınız hayırlı olsun, hepinize kolay gelsin.</p>
